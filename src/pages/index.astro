---
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';
import { getCollection } from 'astro:content';
import FormattedDate from '../components/FormattedDate.astro';

const allPosts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

const featuredPost = allPosts[0];
const otherPosts = allPosts.slice(1);

// Define categories with their matching tags
const categories = [
	{ id: 'all', label: 'All' },
	{ id: 'ai', label: 'AI & Productivity', tags: ['ai', 'productivity', 'claude', 'mobile'] },
	{ id: 'data-grids', label: 'Data Grids', tags: ['data-grids', 'data-grid', 'performance', 'react', 'wasm'] },
	{ id: 'finance', label: 'Finance', tags: ['finance', 'trading'] },
];
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
	</head>
	<body>
		<Header />
		<main>
			<section class="hero">
				<h1>AI &amp; Data Infrastructure for Finance</h1>
				<p class="tagline">
					Deep technical insights on building high-performance data grids,
					AI-powered applications, and software that handles real money.
				</p>
			</section>

			{featuredPost && (
				<section class="featured">
					<span class="featured-label">Featured</span>
					<a href={`/blog/${featuredPost.id}/`} class="featured-card">
						<div class="featured-content">
							<h2 class="featured-title">{featuredPost.data.title}</h2>
							<p class="featured-description">{featuredPost.data.description}</p>
							<div class="featured-meta">
								<span class="date"><FormattedDate date={featuredPost.data.pubDate} /></span>
								{featuredPost.data.tags && featuredPost.data.tags.length > 0 && (
									<div class="tags">
										{featuredPost.data.tags.slice(0, 3).map((tag: string) => (
											<span class="tag">{tag}</span>
										))}
									</div>
								)}
							</div>
						</div>
						<span class="read-more">Read article →</span>
					</a>
				</section>
			)}

			<section class="posts-section">
				<div class="posts-header">
					<h2>All Posts</h2>
					<div class="category-filters">
						{categories.map((cat) => (
							<button
								class={`category-pill ${cat.id === 'all' ? 'active' : ''}`}
								data-category={cat.id}
								data-tags={cat.tags ? cat.tags.join(',') : ''}
							>
								{cat.label}
							</button>
						))}
					</div>
				</div>

				<ul class="posts-list">
					{allPosts.map((post) => (
						<li data-tags={post.data.tags?.join(',') || ''}>
							<a href={`/blog/${post.id}/`}>
								<h3 class="title">{post.data.title}</h3>
								<p class="description">{post.data.description}</p>
								<div class="meta">
									<p class="date"><FormattedDate date={post.data.pubDate} /></p>
									{post.data.tags && post.data.tags.length > 0 && (
										<div class="tags">
											{post.data.tags.map((tag: string) => (
												<span class="tag">{tag}</span>
											))}
										</div>
									)}
								</div>
							</a>
						</li>
					))}
				</ul>
				<a href="/blog" class="view-all">View all posts →</a>
			</section>
		</main>
		<Footer />

		<script>
			document.addEventListener('DOMContentLoaded', () => {
				const pills = document.querySelectorAll('.category-pill');
				const posts = document.querySelectorAll('.posts-list li');

				pills.forEach(pill => {
					pill.addEventListener('click', () => {
						// Update active state
						pills.forEach(p => p.classList.remove('active'));
						pill.classList.add('active');

						const category = pill.getAttribute('data-category');
						const filterTags = pill.getAttribute('data-tags')?.split(',').filter(Boolean) || [];

						posts.forEach(post => {
							const postTags = post.getAttribute('data-tags')?.split(',').filter(Boolean) || [];

							if (category === 'all') {
								(post as HTMLElement).style.display = '';
							} else {
								const hasMatchingTag = filterTags.some(tag => postTags.includes(tag));
								(post as HTMLElement).style.display = hasMatchingTag ? '' : 'none';
							}
						});
					});
				});
			});
		</script>

		<style>
			.hero {
				margin-bottom: 3rem;
			}
			.hero h1 {
				font-size: 2.5rem;
				margin-bottom: 1rem;
			}
			.tagline {
				font-size: 1.25rem;
				color: rgb(var(--gray));
				max-width: 600px;
			}

			/* Featured Post */
			.featured {
				margin-bottom: 3rem;
			}
			.featured-label {
				display: inline-block;
				font-size: 0.75rem;
				font-weight: 600;
				text-transform: uppercase;
				letter-spacing: 0.05em;
				color: rgb(var(--accent));
				margin-bottom: 0.75rem;
			}
			.featured-card {
				display: block;
				padding: 2rem;
				background: linear-gradient(135deg, rgba(var(--accent), 0.08) 0%, rgba(var(--accent), 0.02) 100%);
				border: 1px solid rgba(var(--accent), 0.2);
				border-radius: 16px;
				text-decoration: none;
				transition: all 0.2s ease;
			}
			.featured-card:hover {
				border-color: rgb(var(--accent));
				transform: translateY(-2px);
				box-shadow: 0 8px 24px rgba(var(--accent), 0.15);
			}
			.featured-title {
				margin: 0 0 0.75rem 0;
				font-size: 1.75rem;
				color: rgb(var(--black));
				line-height: 1.3;
			}
			.featured-card:hover .featured-title {
				color: rgb(var(--accent));
			}
			.featured-description {
				margin: 0 0 1rem 0;
				color: rgb(var(--gray-dark));
				font-size: 1.1rem;
				line-height: 1.6;
			}
			.featured-meta {
				display: flex;
				align-items: center;
				gap: 1rem;
				flex-wrap: wrap;
				margin-bottom: 1rem;
			}
			.featured-meta .date {
				color: rgb(var(--gray));
				font-size: 0.9rem;
			}
			.read-more {
				color: rgb(var(--accent));
				font-weight: 500;
				font-size: 0.95rem;
			}

			/* Posts Section */
			.posts-section {
				margin-bottom: 2rem;
			}
			.posts-header {
				display: flex;
				align-items: center;
				justify-content: space-between;
				gap: 1rem;
				margin-bottom: 1.5rem;
				flex-wrap: wrap;
			}
			.posts-header h2 {
				margin: 0;
			}
			.category-filters {
				display: flex;
				gap: 0.5rem;
				flex-wrap: wrap;
			}
			.category-pill {
				padding: 0.5rem 1rem;
				border: 1px solid rgba(var(--gray), 0.3);
				border-radius: 20px;
				background: transparent;
				color: rgb(var(--gray));
				font-size: 0.875rem;
				cursor: pointer;
				transition: all 0.2s ease;
				font-family: inherit;
			}
			.category-pill:hover {
				border-color: rgb(var(--accent));
				color: rgb(var(--accent));
			}
			.category-pill.active {
				background: rgb(var(--accent));
				border-color: rgb(var(--accent));
				color: white;
			}

			/* Posts List */
			.posts-list {
				list-style: none;
				padding: 0;
				display: flex;
				flex-direction: column;
				gap: 1rem;
			}
			.posts-list li {
				margin: 0;
			}
			.posts-list a {
				text-decoration: none;
				display: block;
				padding: 1.5rem;
				background: var(--bg-secondary);
				border-radius: 12px;
				border: 1px solid rgba(var(--gray), 0.2);
				transition: all 0.2s ease;
			}
			.posts-list a:hover {
				border-color: rgb(var(--accent));
				transform: translateY(-2px);
				box-shadow: 0 4px 12px rgba(var(--gray), 0.15);
			}
			.posts-list .title {
				margin: 0 0 0.5rem 0;
				color: rgb(var(--black));
				font-size: 1.35rem;
				font-weight: 600;
				line-height: 1.3;
			}
			.posts-list a:hover .title {
				color: rgb(var(--accent));
			}
			.posts-list .description {
				margin: 0 0 0.75rem 0;
				color: rgb(var(--gray));
				font-size: 1rem;
				line-height: 1.5;
				display: -webkit-box;
				-webkit-line-clamp: 2;
				-webkit-box-orient: vertical;
				overflow: hidden;
			}
			.meta {
				display: flex;
				align-items: center;
				gap: 1rem;
				flex-wrap: wrap;
			}
			.date {
				font-size: 0.875rem;
				color: rgb(var(--gray));
				margin: 0;
			}
			.tags {
				display: flex;
				gap: 0.5rem;
				flex-wrap: wrap;
			}
			.tag {
				font-size: 0.75rem;
				padding: 0.25rem 0.5rem;
				background: rgba(var(--accent), 0.1);
				color: rgb(var(--accent));
				border-radius: 4px;
			}
			.view-all {
				display: inline-block;
				margin-top: 1.5rem;
			}

			@media (max-width: 720px) {
				.hero h1 {
					font-size: 1.75rem;
				}
				.tagline {
					font-size: 1rem;
				}
				.featured-card {
					padding: 1.5rem;
				}
				.featured-title {
					font-size: 1.35rem;
				}
				.featured-description {
					font-size: 1rem;
				}
				.posts-header {
					flex-direction: column;
					align-items: flex-start;
				}
				.category-filters {
					width: 100%;
					overflow-x: auto;
					padding-bottom: 0.5rem;
					flex-wrap: nowrap;
				}
				.category-pill {
					white-space: nowrap;
					flex-shrink: 0;
				}
				.posts-list .title {
					font-size: 1.15rem;
				}
			}
		</style>
	</body>
</html>
